rm(list=ls())
# 2. Install & Load Libraries
packages <- c(
"metafor", "tidyverse", "ggtext", "gridExtra", "broom", "knitr", "xtable", "rstudioapi","readxl", "writexl"
)
install_and_load <- function(pkg) {
if (!requireNamespace(pkg, quietly = TRUE)) {
install.packages(pkg)
}
library(pkg, character.only = TRUE)
}
invisible(lapply(packages, install_and_load))
# Get the directory two levels above the script (i.e., the project root)
# Use knitr::current_input() for knitting, rstudioapi for interactive use
if (!is.null(knitr::current_input())) {
# When knitting
project_root <- dirname(dirname(normalizePath(knitr::current_input())))
} else if (rstudioapi::isAvailable()) {
# When running interactively in RStudio
project_root <- dirname(dirname(rstudioapi::getActiveDocumentContext()$path))
} else {
# Fallback: use current working directory's parent
project_root <- dirname(getwd())
}
# Define data and output directories
data_dir   <- file.path(project_root, "Data")
output_dir <- file.path(project_root, "Plots")
if (!dir.exists(output_dir)) dir.create(output_dir)
df_raw <- readxl::read_excel(file.path(data_dir, "Data_final.xlsx"))
# 5. Convert German-style commas to points for numeric columns (defined manually)
numeric_cols <- c(
"n_total", "n_treatment", "M_treatment", "M_treatment_emm", "M_treatment_perc","CI_lower_treatment",
"CI_upper_treatment", "SE_treatment", "SD_treatment", "n_control", "M_control",
"M_control_emm", "M_control_perc", "CI_lower_control",
"CI_upper_control", "t_value", "SE_control", "SD_control",
"F_value", "odds_ratio", "CI_lower_or", "CI_upper_or",
"cohens_d", "M_diff", "SE_diff"
)
df_clean <- df_raw
for (col in numeric_cols) {
if (col %in% names(df_clean)) {
df_clean[[col]] <- df_clean[[col]] |>
as.character() |>
str_replace_all(",", ".") |>
as.numeric()
}
}
df_clean$pub_year <- df_clean$`Publication Year`
